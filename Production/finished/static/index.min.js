"use strict";{function perror(t){console.error(t);const e=document.createElement("p");document.getElementsByClassName("content")[0].remove(),e.innerHTML=t+"<br />:(",e.style.margin="24px",document.body.append(e),gg=1}try{eval('"use strict"; let foo = () => true;')}catch{throw perror("Your browser doesn't support ES6"),new Error("ES6 is required")}}Math.clamp=(t,e,n)=>t>e?e:t<n?n:t;const _tfind=(t,e)=>{for(let n=0;n<t.length;n++){if(e(t.item(n),n))return t.item(n)}},_tany=(t,e)=>{for(let n=0;n<t.length;n++){if(e(t.item(n),n))return!0}return!1},fn=async function(){const t=document.getElementById("screen"),e=t.getContext("webgl2"),n=document.getElementById("image"),i=t=>null==t;{let t=document.getElementById("chrome-notice"),e=window.navigator.userAgent.toLowerCase();e=e.indexOf("mobile")>=0||e.indexOf("phone")>=0||e.indexOf("ios")>=0||e.indexOf("andrioid")>=0;let n=void 0!==window.chrome&&null!==window.chrome||-1!==window.navigator.userAgent.indexOf("Chrome");e&&(t.innerHTML="Brush or drag your finger across the screen."+(n?"":" "+t.innerHTML)),n&&!e&&(t.style.display="none")}{const r=t=>{console.error(t);const e=document.createElement("p");throw document.getElementsByClassName("content")[0].remove(),e.innerHTML=t+"<br \\>:(",e.style.margin="24px",document.body.append(e),new Error("Something went wrong--see page")};i(t)&&r("Your browser does not support canvas."),(i(e)||i(e.viewport))&&r("Your browser does not suppport WebGL2 (WebGL1 won't work)."),i(n)&&r("Problem loading image.")}const r=t=>{switch(t){case e.NO_ERROR:return"WebGL: NO_ERROR (were you expecting one?)";case e.INVALID_ENUM:return"WebGL: INVALID_ENUM";case e.INVALID_VALUE:return"WebGL: INVALID_VALUE";case e.INVALID_OPERATION:return"WebGL: INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"WebGL: INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"WebGL: OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"WebGL: CONTEXT_LOST_WEBGL";default:return"WebGL threw an undefined error!"}};e.getErrorStr=()=>r(e.getError()),t.width=t.clientWidth,t.height=t.clientHeight;let o=t.width/2,a=t.height/2,s=0,c=0,l=-1,h=-1,d=null,u=null;e.viewport(0,0,t.width,t.height),e.clearColor(0,0,0,0),e.clearDepth(1),e.enable(e.BLEND),e.disable(e.DEPTH_TEST),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA);const f=(t,n)=>{const i=e.createShader(n);if(e.shaderSource(i,t),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS))return i;{const t=n===e.VERTEX_SHADER?"vertex shader":n===e.FRAGMENT_SHADER?"fragment shader":"undefined shader";console.error("a(n) "+t+" shader did not compile: "+e.getShaderInfoLog(i))}},A=(t,n)=>{const i=e.createProgram();{const r=f(t,e.VERTEX_SHADER),o=f(n,e.FRAGMENT_SHADER);e.attachShader(i,r),e.attachShader(i,o)}return e.linkProgram(i),i},m={fb1:e.createFramebuffer(),tx1:e.createTexture(),fb2:e.createFramebuffer(),tx2:e.createTexture()},E=new function(){let n=!1;const i=A("\n\t\t\tattribute float vertexNum;\n\t\t\t\n\t\t\t#define TUPI radians( 360. )\n\t\t\t\n\t\t\tattribute vec2 Acenter;\n\t\t\tattribute vec2 AR;\n\t\t\tattribute float Aang1;\n\t\t\tattribute float Aang2;\n\t\t\tattribute vec4 Acolor;\n\t\t\t\n\t\t\tvarying vec2 Vcenter;\n\t\t\tvarying vec2 VR;\n\t\t\tvarying float Vang1;\n\t\t\tvarying float Vang2;\n\t\t\tvarying vec4 Vcolor;\n\t\t\tvarying float delta;\n\t\t\t\n\t\t\tuniform vec2 Uresolution;\n\t\t\t\n\t\t\tvoid main () {\n\t\t\t\tvec2 mask = vec2( sign( ( vertexNum - 1.5 ) / 2.0 ), sign( ( mod( vertexNum, 2.0 ) - 0.5 ) ) );\n\t\t\t\tvec2 cen = ( Acenter - Uresolution / 2. );\n\t\t\t\tfloat scaling = 1. + 2.0 / ( 1. + pow( 1.005, max( min( Uresolution.x - 100., Uresolution.y - 100. ), 0. ) ) );\n\t\t\t\tvec2 pos = ( AR.x * scaling * mask + cen ) / Uresolution * 2.;\n\n\t\t\t\tgl_Position = vec4( pos, 0., 1. );\n\t\t\t\t\n\t\t\t\tVcenter = Acenter;\n\t\t\t\tVR = AR;\n\t\t\t\tVang1 = Aang1;\n\t\t\t\tVang2 = Aang2;\n\t\t\t\tVcolor = Acolor;\n\t\t\t}\n\t\t","\n// \t\t\t#ifdef GL_OES_standard_derivatives\n// \t\t\t#extension GL_OES_standard_derivatives : enable\n// \t\t\t#endif\n\n\t\t\t#define PI radians( 180. )\n\t\t\t#define TUPI radians( 360. )\n\n\t\t\t#ifdef GL_FRAGMENT_PRECISION_HIGH\n\t\t\t\tprecision highp float;\n\t\t\t#else\n\t\t\t\tprecision mediump float;\n\t\t\t#endif\n\n\t\t\tvarying vec2 Vcenter;\n\t\t\tvarying vec2 VR;\n\t\t\tvarying float Vang1;\n\t\t\tvarying float Vang2;\n\t\t\tvarying vec4 Vcolor;\n\n\t\t\tvoid main () {\n\t\t\t\tvec2 diff = gl_FragCoord.xy - Vcenter;\n\t\t\t\tfloat alpha = 0.;\n//\t\t\t\tThere was an issue with the squares overflowing the float val, so I had to change to highp.\n// \t\t\t\tBut, highp is not universally supported, so I can fall back to mediump \n\t\t\t\t#ifndef GL_FRAGMENT_PRECISION_HIGH\n\t\t\t\t\tvec2 R2 = VR;\n\t\t\t\t\tvec2 dist = vec2( dot( diff / VR.x, diff ), dot( diff / VR.y, diff ) );\n\t\t\t\t#else\n\t\t\t\t\tvec2 R2 = VR * VR;\n\t\t\t\t\tfloat dotp = dot( diff, diff );\n\t\t\t\t\tvec2 dist = vec2( dotp, dotp );\n\t\t\t\t#endif\n\t\t\t\t\n// \t\t\t\t#ifdef GL_OES_standard_derivatives\n// \t\t\t\tfloat delta = abs( dFdx( dist ) ) + abs( dFdy( dist ) );\n// \t\t\t\tdelta = delta < 1. ? 1. : delta;\n// \t\t\t\t#else\n\t\t\t\tfloat delta = 2. * VR.x;\n// \t\t\t\t#endif\n\n//\t\t\t\tWith the altdelta was too big, so I 4th rooted it.\n\t\t\t\t#ifndef GL_FRAGMENT_PRECISION_HIGH\n\t\t\t\t\tdelta = pow( delta, 1./4. );\n\t\t\t\t#endif\n\n//\t\t\t\tFixed hole-in-the-circle problem, may make this better later.\n\t\t\t\tif ( dist.x < R2.x - delta && R2.y == 0. ) {\n\t\t\t\t\talpha = 1.;\n\t\t\t\t} else {\n\t\t\t\t\t/*\n\t\t\t\t\t\tCHANGE THIS WAY OF DOING THINGS!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! \n\t\t\t\t\t\tYOU CAN DO THIS WITH MATRIX MATH.\n\t\t\t\t\t*/\n\t\t\t\t\tfloat theta = atan( -diff.y, -diff.x ) + PI;\n\n\t\t\t\t\tfloat deltaT = 0.010;\n\t\t\t\t\talpha = 1.0 - smoothstep( R2.x - delta, R2.x + delta, dist.x )\n\t\t\t\t\t\t\t\t- smoothstep( R2.y + delta, R2.y - delta, dist.y );\n\n\t\t\t\t\tif ( Vang2 < TUPI ) {\n\t\t\t\t\t\tif ( Vang2 > Vang1 ) {\n\t\t\t\t\t\t\talpha = alpha - smoothstep( Vang1 + deltaT, Vang1 - deltaT, theta )\n\t\t\t\t\t\t\t\t\t\t  - smoothstep( Vang2 - deltaT, Vang2 + deltaT, theta );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif ( theta > Vang2 + deltaT ) {\n\t\t\t\t\t\t\t\talpha = alpha - smoothstep( Vang1 + deltaT, Vang1 - deltaT, theta );\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\talpha = alpha - smoothstep( Vang2 - deltaT, Vang2 + deltaT, theta );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\talpha = clamp( alpha, 0., 1. );\n\n\t\t\t\t\t// if ( alpha == 0. )\n\t\t\t\t\t// \tdiscard;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tgl_FragColor = vec4( Vcolor.rgb, Vcolor.a * alpha );\n\t\t\t}\n\t\t");e.useProgram(i);const r=e.getAttribLocation(i,"vertexNum"),s=e.getAttribLocation(i,"Acenter"),d=e.getAttribLocation(i,"AR"),u=e.getAttribLocation(i,"Aang1"),f=e.getAttribLocation(i,"Aang2"),E=e.getAttribLocation(i,"Acolor"),R=e.getUniformLocation(i,"Uresolution");e.uniform2f(R,t.width,t.height);const g=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,g),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,1,2,3]),e.STATIC_DRAW);const T=.2,b=10;let v=[];this.circles=[];const F=[.745,.96,.976,.8],w=[.745,.96,.976,.8],_=(e,n,i,r,o,a)=>{this.circles.push(e),this.circles.push(n),this.circles.push(r),this.circles.push(i),this.circles.push(i),this.circles.push(0),this.circles.push(r),this.circles.push(!1);const s=document.getElementById("circ"+a);this.circles.push(s),s.style.left=e-s.clientWidth/2+"px",s.style.top=t.height-n-s.clientHeight/2+"px";let c=o+Math.PI>2*Math.PI?o-Math.PI:o+Math.PI,l=o+1.7*Math.PI>2*Math.PI?o-.3*Math.PI:o+1.7*Math.PI,h=o+.7*Math.PI>2*Math.PI?o-1.3*Math.PI:o+.7*Math.PI;v=[...v,e,n,.66*i,0,0,2*Math.PI+.001,...F,e,n,i,.914*i,c,l,...w,e,n,i,.914*i,o,h,...w]};const x=(t,e)=>{const n=this.circles[9*t+0],i=this.circles[9*t+1];let r=this.circles[9*t+2],o=this.circles[9*t+3],a=this.circles[9*t+4],s=this.circles[9*t+5],l=this.circles[9*t+6];const h=this.circles[9*t+7];a=a===1/0||NaN===a?p:a,l=l===1/0||NaN===l?T:l,r=r===1/0||NaN===r?T:r,s=s===1/0||NaN===s?0:s,o=o===1/0||NaN===o?p:o,o=o>e?e:o,r=r>16?8:r,l=l>16?8:l;const d=a-o;s=s*Math.clamp(1+.0124*Math.abs(d)-.24*Math.max(Math.abs(s)-.36,0),.986,.02)+.022*d*c,o+=s*c,!0===h&&o<=0&&(s=0,o=0);let u=.05;switch(l){case T:u=.04;break;case 8:u=.108;break;case 0:u=.04}r+=u*(l-r)*c,r>=l-.01&&8===l&&(l=0),v[t*b*3+0]=n,v[t*b*3+b]=n,v[t*b*3+20]=n,v[t*b*3+1]=i,v[t*b*3+b+1]=i,v[t*b*3+20+1]=i,v[t*b*3+2]=.66*o,v[t*b*3+b+2]=o,v[t*b*3+b+3]=.914*o,v[t*b*3+20+2]=o,v[t*b*3+20+3]=.914*o,this.circles[9*t+5]=s,this.circles[9*t+3]=o,this.circles[9*t+2]=r,this.circles[9*t+6]=l;let f=v[30*t+b+4],A=v[30*t+b+5],m=v[30*t+20+4],E=v[30*t+20+5];f=f===1/0||NaN===f?0:f,A=A===1/0||NaN===A?.7*Math.PI:A,m=m===1/0||NaN===m?Math.PI:m,E=E===1/0||NaN===E?1.7*Math.PI:E;const R=r*c/(125/3);v[30*t+b+4]=f+R>=2*Math.PI?f+R-2*Math.PI:f+R,v[30*t+b+5]=A+R>=2*Math.PI?A+R-2*Math.PI:A+R,v[30*t+20+4]=m+R>=2*Math.PI?m+R-2*Math.PI:m+R,v[30*t+20+5]=E+R>=2*Math.PI?E+R-2*Math.PI:E+R};(t.width<960||t.height<540)&&console.warn("To developer: Rendering circles on small a screen--are you sure you want to do this?");let p=0,I=0,y=0,B=0,L=0;const U=()=>{const e=document.getElementById("chrome-notice"),n=document.getElementById("webgl-lost-notice"),i=document.getElementsByClassName("site-header")[0],r="none"===e.style.display?0:e.clientHeight+64,o="block"!==n.style.display?0:n.clientHeight,a=i.clientHeight;return(t.width>1024?Math.max(r,a):r+a)+o},M=()=>{const e=t.height-U(),n=Math.max(t.width,e),i=Math.min(t.width,e);p=Math.sqrt(n*i/36/2),I=1.1*p,y=1.9*I,B=1.4*I,L=1.3*y,document.querySelector(":root").style.setProperty("--crc-txt-sz",2*p+"px")};M();(e=>{let n=[],i=50000001;this.circles=[];const r=t.height-U();for(let o=0;o<e;o++){let e=[],o=0,a=0,s=0;if(t.width<t.height){a=Math.random()*(t.width-2*B)+B,s=Math.random()>.5?B:r-B}else{s=Math.random()*(r-2*B)+B,a=Math.random()>.5?B:t.width-B}e[0]=a,e[1]=s;for(let n=1;n<6;n++){let i=2*Math.random()*Math.PI,a=0,s=e[2*n-2]+L*Math.cos(i),c=e[2*n-1]+L*Math.sin(i),l=s,h=c,d=5e7/6;const u=()=>{const i=t=>t>0?t:0;let o=i(B-s)+i(s-(t.width-B))+i(B-c)+i(c-(r-B));o*=2*o;for(let t=0;t<=n;t++){let n=s-e[2*t],r=c-e[2*t+1];o+=i(y*y-(n*n+r*r))}return o>0&&(o<d&&(l=s,h=c,d=o),!0)};let f=36;for(;u()&&f>0;)i=2*Math.random()*Math.PI,a=L*(.8+.2*Math.random()),s=e[2*n-2]+a*Math.cos(i),c=e[2*n-1]+a*Math.sin(i),f-=1;u()&&(s=l,c=h),e[2*n]=s,e[2*n+1]=c,o+=d}o<i&&(i=o,n=e,console.log("best_err: "+i))}for(let t=0;t<6;t++){let e=Math.random()*Math.PI*2;_(n[2*t],n[2*t+1],p,T,e,t+1)}})(32);const N=(e,n,i)=>{const r=t.height-U(),o=t=>(t>0)*t,a=[];let s=1/4;for(let t=0;t<6;t++)this.circles[9*t+0]*=n,this.circles[9*t+1]*=i;for(let n=0;n<e;n++){for(let e=0;e<6;e++){a[2*e+0]=0,a[2*e+1]=0;const n=this.circles[9*e+0],i=this.circles[9*e+1],c=t=>{const r=n-this.circles[9*t+0],o=i-this.circles[9*t+1];r*r+o*o<L*y&&(a[2*e+0]+=r,a[2*e+1]+=o)};for(let t=0;t<e;t++)c(t);for(let t=e+1;t<6;t++)c(t);a[2*e+0]+=2*(o(B-n)-o(n-(t.width-B))),a[2*e+1]+=2*(o(B-i)-o(i-(r-B))),this.circles[9*e+0]+=a[2*e+0]*s,this.circles[9*e+1]+=a[2*e+1]*s}s/=1.02}for(let e=0;e<6;e++){const n=this.circles[9*e+8];n.style.left=this.circles[9*e+0]-n.clientWidth/2+"px",n.style.top=t.height-this.circles[9*e+1]-n.clientHeight/2+"px"}},P=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,P),e.bufferData(e.ARRAY_BUFFER,new Float32Array(v),e.STATIC_DRAW);this.update=()=>{e.useProgram(i);const n=t.width+t.height;for(var o=0;o<6;o++)x(o,n);e.bindBuffer(e.ARRAY_BUFFER,P);let a=new Float32Array(v);e.bufferSubData(e.ARRAY_BUFFER,0,a,0,Math.round(180)),e.enableVertexAttribArray(r),e.enableVertexAttribArray(s),e.enableVertexAttribArray(d),e.enableVertexAttribArray(u),e.enableVertexAttribArray(f),e.enableVertexAttribArray(E),e.bindBuffer(e.ARRAY_BUFFER,g),e.vertexAttribPointer(r,1,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,P),e.vertexAttribPointer(s,2,e.FLOAT,!1,40,0),e.vertexAttribPointer(d,2,e.FLOAT,!1,40,8),e.vertexAttribPointer(u,1,e.FLOAT,!1,40,16),e.vertexAttribPointer(f,1,e.FLOAT,!1,40,20),e.vertexAttribPointer(E,4,e.FLOAT,!1,40,24),e.vertexAttribDivisor(s,1),e.vertexAttribDivisor(d,1),e.vertexAttribDivisor(u,1),e.vertexAttribDivisor(f,1),e.vertexAttribDivisor(E,1),e.bindFramebuffer(e.FRAMEBUFFER,m.fb1),e.drawArraysInstanced(e.TRIANGLE_STRIP,0,4,18),e.bindFramebuffer(e.FRAMEBUFFER,null),e.disableVertexAttribArray(r),e.disableVertexAttribArray(s),e.disableVertexAttribArray(d),e.disableVertexAttribArray(u),e.disableVertexAttribArray(f),e.disableVertexAttribArray(E)},this.mousemove=(t,e)=>{if(!1===n)for(let n=0;n<6;n++){const i=this.circles[9*n+0],r=this.circles[9*n+1],o=this.circles[9*n+3],a=t-i,s=e-r;a*a+s*s<=o*o?(this.circles[9*n+4]=I,0!=this.circles[9*n+6]&&(this.circles[9*n+6]=8)):(this.circles[9*n+4]=p,this.circles[9*n+6]=T)}};let D=!1;this.resize=(n,r,s=10)=>{e.useProgram(i),e.uniform2f(R,t.width,t.height),M(),this.mousemove((l+1)*o,-(h-1)*a);const c=t.width/n,d=t.height/r;clearTimeout(D),D=setTimeout((()=>N(s,c,d)),40)},this.reset=t=>{if(console.log("reset"),!1===n)for(let e=0;e<6;e++)this.circles[9*e+4]=p,this.circles[9*e+6]=T,this.circles[9*e+7]=!1,!0===t&&(this.circles[9*e+5]=0,this.circles[9*e+2]=T,this.circles[9*e+3]=p);else this.circles[9*n+3]=this.circles[9*n+4],this.circles[9*n+5]=0};const V=e=>{for(let n=0;n<6;n++){const i=this.circles[9*n+0],r=this.circles[9*n+1];n===e?setTimeout((()=>{const e=t.width+Math.abs(i-o),s=t.height+Math.abs(r-a);this.circles[9*n+4]=1.1*Math.sqrt(e*e+s*s),this.circles[9*n+6]=0}),500):setTimeout((()=>{this.circles[9*n+4]=0,this.circles[9*n+6]=0,this.circles[9*n+7]=!0}),200)}n=e};this.click=(t,e)=>{!1!==n&&console.error("circles.click should not be called when a circle is already selected.");for(let n=0;n<6;n++){const i=this.circles[9*n+0],r=this.circles[9*n+1],o=this.circles[9*n+3],a=t-i,s=e-r;if(a*a+s*s<=o*o)return V(n),n}return-1},this.deselect=t=>{this.circles[9*t+4]=p,this.circles[9*t+6]=T,this.circles[9*t+7]=!1,setTimeout((()=>{n=!1,this.mousemove((l+1)*o,-(h-1)*a)}),600)}},R=new function(){const i=A("\n\t\t\tattribute vec2 Apos;\n\t\t\tattribute vec2 AtexBk;\n\t\t\tvarying vec2 VtexBk;\n\t\t\tattribute vec2 AtexFg;\n\t\t\tvarying vec2 VtexFg;\n\n\t\t\tvoid main() {\n\t\t\t\tgl_Position = vec4( Apos, 0., 1. );\n\t\t\t\tVtexBk = AtexBk;\n\t\t\t\tVtexFg = AtexFg;\n\t\t\t}\n\t\t","\n\t\t\tprecision mediump float;\n\t\t\tuniform sampler2D UtexBk;\n\t\t\tvarying vec2 VtexBk;\n\t\t\tuniform sampler2D UtexFg;\n\t\t\tvarying vec2 VtexFg;\n\n\t\t\tvec4 accurate_mix ( vec4 bk, vec4 fg ) {\n\t\t\t\tfloat alpha = 1.0 - fg.a;\n\n//\t\t\t\tGamma correction of 2, close enough to 2.2 or whatever the ideal ratio is.\n\t\t\t\tvec3 color = sqrt( fg.rgb * fg.rgb + bk.rgb * bk.rgb * alpha );\n\n\t\t\t\tfloat out_alpha = fg.a + bk.a * alpha;\n\t\t\t\treturn vec4( color, out_alpha );\n\t\t\t}\n\n\t\t\tvoid main() {\n\t\t\t\tvec4 final_color = accurate_mix( texture2D( UtexBk, VtexBk ), texture2D( UtexFg, VtexFg ) );\n\t\t\t\tgl_FragColor = vec4( final_color.rgb, 1.0 );\n\t\t\t}\n\t\t");e.useProgram(i);const o=e.getAttribLocation(i,"Apos"),a=e.getAttribLocation(i,"AtexBk"),s=e.getUniformLocation(i,"UtexBk"),d=e.getAttribLocation(i,"AtexFg"),u=e.getUniformLocation(i,"UtexFg");let f,E,R,g;e.uniform1i(s,1),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,m.tx1),e.uniform1i(u,0);const T=.1;let b=[];const v=e.createBuffer();this.finishInitTexture=async function(){e.activeTexture(e.TEXTURE1);const i=e.createTexture();e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n);let o=null,a=0,s=1;for(;(o=e.getError())!==e.NO_ERROR;){console.warn(r(o));const t=document.createElement("canvas"),c=t.getContext("2d");t.width=n.width>>1,t.height=n.height>>1,console.log("w: "+n.width+", rw: "+t.width+", rh: "+t.height),c.drawImage(n,0,0,t.width,t.height);const l=t.toDataURL();n.src=l;const h=()=>new Promise((t=>{n.onload=()=>{e.bindTexture(e.TEXTURE_2D,i),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n),console.log("w: "+n.width+", h: "+n.height),t()}}));if(await h(),s*=2,a++>256)break}f=.5*n.width*s,E=.5*n.height*s,R=Math.min(1,2*t.width/f),g=Math.min(1,2*t.height/E);{const t=.5*(1-R)+T*R,e=.5*(1-g)+T*g,n=t+R-.2*R,i=e+g-.2*g;b=new Float32Array([n,i,n,e,t,i,t,e])}e.bindBuffer(e.ARRAY_BUFFER,v),e.bufferData(e.ARRAY_BUFFER,b,e.STATIC_DRAW)};const F=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,F),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,-1,1,1]),e.DYNAMIC_DRAW);const w=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,w),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,1]),e.STATIC_DRAW);const _=()=>{const t=b.map(((t,e)=>t+(e%2==0?this.x:this.y)));e.bindBuffer(e.ARRAY_BUFFER,v),e.bufferSubData(e.ARRAY_BUFFER,0,t,0,8)},x=8e-4;this.x=0,this.y=0,this.update=()=>{e.useProgram(i);let t=x*(l-this.x/T/R),n=x*(h-this.y/T/g);this.x+=t*c,this.y+=n*c,_(),e.enableVertexAttribArray(o),e.enableVertexAttribArray(a),e.enableVertexAttribArray(d),e.bindBuffer(e.ARRAY_BUFFER,F),e.vertexAttribPointer(o,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,v),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,w),e.vertexAttribPointer(d,2,e.FLOAT,!1,0,0),e.vertexAttribDivisor(o,0),e.vertexAttribDivisor(a,0),e.vertexAttribDivisor(d,0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.drawArrays(e.TRIANGLE_STRIP,0,4),e.disableVertexAttribArray(o),e.disableVertexAttribArray(a),e.disableVertexAttribArray(d)},this.resize=()=>{R=Math.min(1,2*t.width/f),g=Math.min(1,2*t.height/E);{const t=.5*(1-R)+T*R,e=.5*(1-g)+T*g,n=t+R-.2*R,i=e+g-.2*g;b=new Float32Array([n,i,n,e,t,i,t,e])}e.bindBuffer(e.ARRAY_BUFFER,v),e.bufferData(e.ARRAY_BUFFER,b,e.STATIC_DRAW)},this.reset=()=>{this.x=0,this.y=0}},g=new function(){const e=.6,n=document.getElementsByClassName("page"),i=document.getElementById("back-arrow"),r=document.getElementsByClassName("disappear-on-focus");let o,a=null,s=-1,l=null,h=0,d=0,u=0,f=0;const A=()=>{this.focused=!1,i.onpointerover=void 0,i.onpointerout=void 0,i.onclick=void 0,f=0,o=setTimeout((()=>{i.style.display="none",this.update=()=>{}}),500),a.classList.add("fade-out"),a.classList.remove("fade-in"),l=setTimeout((()=>{a.style.display="none";for(const t of r)t.classList.add("fade-in"),t.classList.remove("fade-out"),t.style.display="block";setTimeout((()=>E.resize(t.width,t.height)),2)}),450),E.deselect(s),t.onclick=x,window.onhashchange=void 0},m=()=>{f=1},R=()=>{f=e};this.show=t=>{-1!==t&&(this.focused=!0,clearTimeout(o),s===t&&clearTimeout(l),i.style.display="block",i.onpointerover=m,i.onpointerout=R,i.onclick=A,this.update=g,f=e,a=n[t],s=t,l=null,a.style.display="block",a.classList.add("fade-in"),a.classList.remove("fade-out"),window.location.href="#pg",setTimeout((()=>{window.onhashchange=A}),200))};const g=()=>{d=.024*(f-h),u=u+d*c-.08*u,h+=u*c,i.style.opacity=h};this.update=()=>{},this.focused=!1,this.reset=()=>{f=e,h=e,u=0,d=0}},T=t=>{c=t-s,c/=24,e.bindFramebuffer(e.FRAMEBUFFER,null),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.bindFramebuffer(e.FRAMEBUFFER,m.fb1),e.clear(e.COLOR_BUFFER_BIT),e.bindFramebuffer(e.FRAMEBUFFER,m.fb2),e.clear(e.COLOR_BUFFER_BIT),E.update(),R.update(),g.update(),window.addEventListener("touchmove",v,{passive:!1}),window.onmousemove=F,u=requestAnimationFrame(T),s=t},b=()=>{const n=t.width,i=t.height;t.width=t.clientWidth,t.height=t.clientHeight,o=t.width/2,a=t.height/2,e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,t.width,t.height),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,m.tx1),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t.width,t.height,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.bindFramebuffer(e.FRAMEBUFFER,m.fb1),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,m.tx1,0),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,m.tx2),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t.width,t.height,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.bindFramebuffer(e.FRAMEBUFFER,m.fb2),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,m.tx2,0),E.resize(n,i),R.resize()},v=t=>{let e;!1===g.focused&&t.preventDefault(),t.targetTouches&&!(e=_tfind(t.targetTouches,(t=>t.identifier===d)))||(window.ontouchmove=null,F(e))},F=e=>{window.onmousemove=null,l=e.clientX/o-1,h=-e.clientY/a+1,E.mousemove(e.clientX,t.height-e.clientY)},w=t=>{let e;t.preventDefault(),t.targetTouches&&!(e=_tfind(t.targetTouches,(t=>t.identifier===d)))||(l=0,h=0,window.onpointermove=null,d=null)},_=t=>{cancelAnimationFrame(u),w(t),d=null,l=0,h=0,R.reset(),g.reset(),E.reset(!0)},x=e=>{!1===g.focused&&e.preventDefault();const n=E.click(e.clientX,t.height-e.clientY);if(setTimeout((()=>{g.show(n)}),800),-1!==n){const e=document.getElementsByClassName("disappear-on-focus");for(let t=0;t<e.length;t++){let n=e[t];n.classList.add("fade-out"),n.classList.remove("fade-in"),setTimeout((()=>{n.style.display="none"}),450)}t.onclick=void 0}};await R.finishInitTexture(),b(),window.onresize=b,screen&&screen.orientation&&(screen.orientation.onchange=t=>{b(),t.stopPropagation()}),window.onorientationchange=t=>{b(),t.stopPropagation()},window.onpagehide=_;const p=t=>{"hidden"===document.visibilityState?_(t):u=requestAnimationFrame(T)};window.addEventListener("visibilitychange",p),t.onclick=x,window.onmouseleave=w,window.onmouseout=w;const I=t=>{null===d&&t.touches&&t.touches.length>0&&(d=t.touches[0].identifier)};window.addEventListener("touchstart",I,{passive:!1});const y=t=>{t.targetTouches&&!_tany(t.targetTouches,(t=>t.identifier===d))||(d=null)};window.addEventListener("touchend",y,{passive:!1}),window.ontouchcancel=e=>{t.ontouchend(e),w(e)},t.addEventListener("webglcontextlost",(()=>{console.warn("deleting WEBGL context..."),cancelAnimationFrame(u),window.onpagehide=void 0,window.removeEventListener("visibilitychange",p),t.onclick=void 0,window.onmousemove=void 0,window.ontouchmove=void 0,window.onmouseleave=void 0,window.onmouseout=void 0,window.removeEventListener("touchstart",I),window.removeEventListener("touchend",y),window.ontouchcancel=void 0;const e=document.getElementsByClassName("content").item(0);e.classList.remove("fade-in"),e.classList.add("fade-out"),setTimeout((()=>{let n=document.createElement("canvas");t.remove(),n.id="screen";let i=document.getElementsByClassName("before-canvas").item(0);e.insertBefore(n,i),document.getElementById("webgl-lost-notice").style.display="block",console.warn("restarting WEBGL context..."),setTimeout(fn,40)}),310)})),setTimeout((()=>{const t=document.getElementsByClassName("content")[0];t.classList.remove("fade-out"),t.classList.add("fade-in")}),80),s=performance.now(),u=requestAnimationFrame(T)};window.onload=fn;
